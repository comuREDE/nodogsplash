language: c
sudo: false

before_script:
  - bash ./build_libmicrohttpd.sh --compile

script:
 - make
 - output=$(make fixstyle | grep formatted); if [[ $output ]]; then while read -r line; do echo -e "\e[00;31m$line\e[00m"; done <<< "$output"; echo -e '\e[00;31mPlease check files formatting using "make fixstyle"\e[00m'; false; fi;

env:
  - CFLAGS="-I/tmp/libmicrohttpd_install/include" LDFLAGS="-L/tmp/libmicrohttpd_install/lib"

addons:
  apt:
    packages:
      - astyle
